<!doctype html>
<html lang="en">

<head>
<meta charset="utf-8"/>
<title>Impact Lab Registration</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<link href="https://fonts.googleapis.com/css2?family=Bagel+Fat+One&family=Playpen+Sans+Thai&display=swap" rel="stylesheet">

<style>

body{
margin:0;
padding:16px;
background:#F5EEDF;
font-family:"Playpen Sans Thai";
}

.card{
max-width:900px;
margin:auto;
background:white;
padding:28px;
border-radius:18px;
box-shadow:0 12px 28px rgba(0,0,0,.18);
}

h1{
font-family:"Bagel Fat One";
margin:0;
font-size:30px;
}

label{
display:block;
margin-top:18px;
font-weight:700;
}

input,select{
width:100%;
padding:14px;
margin-top:8px;
border-radius:12px;
border:1px solid #ccc;
font-size:16px;
box-sizing:border-box;
}

.qr-box{
margin:24px auto;
max-width:260px;
padding:16px;
border:2px solid black;
border-radius:16px;
text-align:center;
}

.qr-box img{
width:100%;
}

.preview{
display:none;
margin-top:12px;
max-width:220px;
border-radius:12px;
border:1px solid #ccc;
}

.btn{
margin-top:28px;
width:100%;
padding:18px;
background:black;
color:white;
border:none;
border-radius:18px;
font-size:18px;
cursor:pointer;
}

.status{
margin-top:12px;
font-size:15px;
color:red;
}

@media(max-width:600px){
h1{font-size:26px;}
.card{padding:20px;}
input,select{padding:16px;}
.qr-box{max-width:220px;}
}

</style>

</head>

<body>

<div class="card">

<h1>Impact Lab Registration</h1>

<form id="form">

<label>Name</label>
<input name="name" required>

<label>Age</label>
<input name="age" required>

<label>Participation Type</label>

<select name="participation" id="participation" required>
<option value="">Select</option>
<option value="individual">Individual</option>
<option value="team">Team</option>
</select>

<div id="teamSection" style="display:none;">

<label>Number of Team Members</label>
<input name="team_count">

<label>Have all team members registered?</label>

<select name="registered">
<option value="">Select</option>
<option>Yes</option>
<option>No</option>
</select>

<label>Team Member Names</label>
<input name="team_names">

</div>

<label>Email</label>
<input name="email" type="email" required>

<label>Phone</label>
<input name="phone" required>

<label>Scan QR</label>

<div class="qr-box">
<img src="qr.png">
</div>

<label>Attach Payment Screenshot</label>
<input type="file" id="paymentImage" accept="image/*">
<img id="preview" class="preview">

<button type="submit" class="btn">
Submit Registration
</button>

<div id="status" class="status"></div>

</form>

</div>

<script type="module">

import { createClient } 
from "https://esm.sh/@supabase/supabase-js@2";

const supabase = createClient(
"https://jwxqlzccxajkwrkawuxj.supabase.co",
"sb_publishable_U4BZXASjmXLOXS8Dts6fgg_UlAFfxZX"
);

const form = document.getElementById("form");
const team = document.getElementById("teamSection");
const part = document.getElementById("participation");
const status = document.getElementById("status");
const paymentInput = document.getElementById("paymentImage");
const preview = document.getElementById("preview");

part.addEventListener("change",()=>{
team.style.display =
part.value === "team" ? "block" : "none";
});

paymentInput.addEventListener("change",()=>{
const file = paymentInput.files[0];
if(!file) return;
const reader = new FileReader();
reader.onload = ()=>{
preview.src = reader.result;
preview.style.display = "block";
};
reader.readAsDataURL(file);
});

form.addEventListener("submit",async(e)=>{

e.preventDefault();
status.textContent="Submitting...";

const { error } = await supabase
.from("submissions")
.insert([{

name:form.name.value,
age:form.age.value,
participation_type:form.participation.value,
team_count:form.team_count.value,
team_registered:form.registered.value,
team_names:form.team_names.value,
email:form.email.value,
phone:form.phone.value

}]);

if(error){
status.textContent="Error: "+error.message;
return;
}

status.textContent="Success!";
setTimeout(()=>{
window.location.href="./thankyou.html";
},1000);

});

</script>

</body>
</html>
